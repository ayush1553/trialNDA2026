<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Current Affairs - NDAPrep</title>
    <meta name="description" content="Latest Current Affairs for NDA Preparation.">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="mock-tests.css"> <!-- Reusing mock-tests css for card layout -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Specific overrides for Current Affairs */
        .ca-container {
            padding-top: 40px;
        }

        .month-header {
            color: var(--text-primary);
            margin: 20px 0;
            padding-left: 10px;
            border-left: 4px solid var(--accent);
        }

        /* Toggle Button Styles (Adapted from chapter-tests.css) */
        .primary-toggle {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 32px;
            padding: 4px;
        }

        .toggle-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .toggle-btn:not(.active):hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
        }

        /* View Pane Logic */
        .view-pane {
            display: none;
        }

        .view-pane.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Daily CA Detail Styles */
        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .ca-question-card {
            background: rgba(255, 255, 255, 0.05);
            /* Glass-like */
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .ca-q-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.6);
        }

        .q-num {
            font-weight: bold;
            color: var(--accent);
            /* Assuming variable exists, else #3b82f6 */
        }

        .ca-q-text {
            font-size: 1.1em;
            font-weight: 500;
            color: #fff;
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .ca-option {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ca-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .opt-key {
            background: rgba(255, 255, 255, 0.1);
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 0.85em;
            font-weight: bold;
        }

        .ca-solution {
            margin-top: 15px;
            padding: 15px;
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid #3b82f6;
            border-radius: 4px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95em;
            line-height: 1.6;
        }
    </style>
</head>

<body>

    <!-- TOP BAR -->
    <header class="topbar">
        <div class="brand">
            <div class="logo"><img src="nda_logo.jpeg" alt="NDA"></div>
            <span>NDAPrep</span>
        </div>
        <div class="menu" onclick="toggleMenu()"><i class="fa-solid fa-bars"></i></div>
    </header>

    <!-- NAVIGATION MENU -->
    <div class="nav-overlay" id="navOverlay">
        <div class="nav-content">
            <div class="nav-header">
                <span class="nav-title">Menu</span>
                <span class="close-menu" onclick="toggleMenu()"><i class="fa-solid fa-xmark"></i></span>
            </div>
            <ul class="nav-links">
                <!-- User Profile Section -->
                <li id="user-display" style="display: none;">
                    <i class="fa-solid fa-circle-user icon"></i>
                </li>

                <li><a href="index.html"><i class="fa-solid fa-house icon"></i> Home Page</a></li>
                <li><a href="mock-tests.html"><i class="fa-solid fa-clipboard-list icon"></i> Mock Tests</a></li>
                <li><a href="pyqs.html"><i class="fa-solid fa-file-lines icon"></i> Previous Year Papers</a></li>
                <li><a href="chapter_tests.html"><i class="fa-solid fa-book-open icon"></i> Chapter Tests</a></li>
                <li><a href="current-affairs.html"><i class="fa-solid fa-newspaper icon"></i> Current Affairs</a></li>
                <li><a href="performance.html"><i class="fa-solid fa-chart-simple icon"></i> Performance Analysis</a>
                </li>

                <li id="login-link"><a href="login.html"><i class="fa-solid fa-right-to-bracket icon"></i> Login</a>
                </li>
                <li id="signup-link"><a href="signup.html"><i class="fa-solid fa-user-plus icon"></i> Sign Up</a></li>
                <li id="logout-link" style="display: none;"><a href="#" onclick="Auth.logout()"><i
                            class="fa-solid fa-sign-out-alt icon"></i> Logout</a></li>

                <li><a href="#"><i class="fa-solid fa-circle-info icon"></i> Update & Info</a></li>
            </ul>
        </div>
    </div>

    <div class="container ca-container">

        <div class="perf-header">
            <h2>Current Affairs</h2>
        </div>

        <!-- Top-Level Toggle -->
        <div class="primary-toggle">
            <button id="toggle-monthly" class="toggle-btn active" onclick="switchTab('Monthly')">Monthly CA</button>
            <button id="toggle-daily" class="toggle-btn" onclick="switchTab('Daily')">Daily CA</button>
            <button id="toggle-topic" class="toggle-btn" onclick="switchTab('Topic')">Topic Wise CA</button>
        </div>

        <!-- Monthly View Pane -->
        <div id="pane-monthly" class="view-pane active">
            <div class="test-list" id="monthly-list-container">
                <!-- Monthly Cards Injected Here -->
            </div>
        </div>

        <!-- Daily View Pane -->
        <div id="pane-daily" class="view-pane">
            <div class="test-list" id="daily-list-container">
                <!-- Daily Cards Injected Here -->
            </div>
        </div>

        <!-- Topic Wise View Pane -->
        <div id="pane-topic" class="view-pane">
            <div class="test-list" id="topic-list-container">
                <!-- Topic Cards Injected Here -->
            </div>
        </div>

        <!-- Detailed Questions View Removed - Now using Instructions Page -->

    </div>

    <script src="auth.js"></script>
    <script src="db.js"></script>
    <script src="script.js"></script>
    <script>
        // Mock data
        const caData = {
            'Monthly': [
                // January Parts
                { id: 301, title: 'January 2026 - Week 1', date: 'Jan 1-7, 2026', type: 'Monthly', readTime: '15 mins', file: 'data/current_affairs/monthly/ct01_january1.js' },
                { id: 302, title: 'January 2026 - Week 2', date: 'Jan 8-14, 2026', type: 'Monthly', readTime: '15 mins', file: 'data/current_affairs/monthly/ct02_january2.js' },
                { id: 303, title: 'January 2026 - Week 3', date: 'Jan 15-21, 2026', type: 'Monthly', readTime: '15 mins', file: 'data/current_affairs/monthly/ct03_january3.js' },
                { id: 304, title: 'January 2026 - Week 4', date: 'Jan 22-31, 2026', type: 'Monthly', readTime: '15 mins', file: 'data/current_affairs/monthly/ct04_january4.js' },
            ],
            'Daily': [
                { id: 101, title: '19th February 2026 - Daily Updates', date: '19 Feb 2026', type: 'Daily', readTime: '10 mins', file: 'data/current_affairs/daily/19_02_2026.js' },
            ],
            'Topic': [
                // Coming soon
            ]
        };

        let currentTab = 'Monthly';

        function switchTab(tab) {
            currentTab = tab;

            // Update Buttons
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`toggle-${tab.toLowerCase()}`).classList.add('active');

            // Update Panes
            document.querySelectorAll('.view-pane').forEach(pane => pane.classList.remove('active'));
            document.getElementById(`pane-${tab.toLowerCase()}`).classList.add('active');

            // Render content if empty (optimization) or just re-render
            renderCards(tab);
        }

        let globalStatusMap = {};

        async function renderCards(tab) {
            const container = document.getElementById(`${tab.toLowerCase()}-list-container`);

            try {
                if (Object.keys(globalStatusMap).length === 0) {
                    const response = await fetch('/api/tests');
                    const tests = await response.json();
                    tests.filter(t => t.category === 'CA').forEach(t => {
                        globalStatusMap[t.test_id] = t.status;
                    });
                }
            } catch (error) {
                console.error('Error fetching test status:', error);
            }

            const data = caData[tab];

            container.innerHTML = data.map(item => {
                const dbStatus = globalStatusMap[item.id] || globalStatusMap[String(item.id)];
                let checkClickAction = '';
                if (item.file && dbStatus !== 'coming_soon') {
                    // Redirect to Instructions Page for GAT-style test
                    checkClickAction = `onclick="window.location.href='instructions.html?type=CurrentAffairs&date=${item.date}&file=${item.file}'"`;
                } else {
                    checkClickAction = `onclick="alert('Content coming soon!')"`;
                }

                return `
                    <div class="test-card" ${checkClickAction} style="cursor: pointer; ${dbStatus === 'coming_soon' ? 'opacity: 0.7;' : ''}">
                        <div class="card-main">
                            <div class="title-row">
                                <div class="test-title">${item.title}</div>
                                <div class="start-link">${dbStatus === 'coming_soon' ? 'Coming Soon' : 'Start Test <i class="fa-solid fa-arrow-right"></i>'}</div>
                            </div>
                            <div class="meta-row">
                                ${item.type} · ${item.readTime} · 40 Marks
                            </div>
                        </div>
                        <div class="card-footer">
                            Published: ${item.date}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Initial render
        window.addEventListener('DOMContentLoaded', () => {
            renderCards('Monthly');
            renderCards('Daily');
            renderCards('Topic');
        });

    </script>
</body>

</html>